<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GPT Quiz Mode | Luminzo (Mobile-Responsive)</title>
  <style>
    :root {
      --bg-1: #06070a;
      --bg-2: #071329;
      --card: rgba(255, 255, 255, 0.03);
      --accent: #00d2ff;
      --accent-2: #7b2cff;
      --muted: #8f9aa3;
      --success: #26c281;
      --danger: #ff6b6b;
      --glass-border: rgba(255, 255, 255, 0.06);
    }

    /* ===== base ===== */
    * {
      box-sizing: border-box;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: linear-gradient(90deg, var(--bg-1), var(--bg-2));
      color: #e6eef6;
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: var(--accent);
      text-decoration: none
    }

    button {
      font-family: inherit
    }

    /* ===== launch banner ===== */
    .launch-banner {
      width: 100%;
      background: linear-gradient(90deg, #10263a, #071423 60%, #02121a);
      color: #bfefff;
      padding: 10px;
      text-align: center;
      font-weight: 600;
      font-size: 13px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.02);
    }

    /* ===== topbar with hamburger ===== */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 14px;
      margin: 12px auto;
      max-width: 980px;
     background: linear-gradient(90deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      position: relative;
      z-index: 40;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px
    }

    .logo {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--accent-2), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #041426;
      font-size: 18px
    }

    .brand h1 {
      font-size: 15px;
      margin: 0;
      color: #eaf7ff
    }

    .brand p {
      margin: 0;
      font-size: 11px;
      color: var(--muted)
    }

    /* nav actions for desktop */
    .nav-actions {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .nav-actions .small {
      background: rgba(255, 255, 255, 0.03);
      color: #eaf7ff;
      border: 1px solid rgba(255, 255, 255, 0.03);
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer
    }

    .nav-actions .small:hover {
      transform: translateY(-3px)
    }

    /* hamburger (mobile) */
    .hamburger {
      display: flex;
      align-items: center;
      gap: 10px
    }

    .hambutton {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.03);
      display: grid;
      place-items: center;
      cursor: pointer
    }

    .hambutton:hover {
      transform: translateY(-3px)
    }

    .hambutton svg {
      width: 20px;
      height: 20px;
      fill: #eaf7ff
    }

    /* ===== page wrapper ===== */
    .page {
      max-width: 980px;
      margin: 18px auto;
      padding: 0 14px 60px;
    }

    /* ===== card styling ===== */
    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border: 1px solid rgba(255, 255, 255, 0.04);
      border-radius: 14px;
      padding: 14px;
      margin-bottom: 14px;
      box-shadow: 0 10px 30px rgba(2, 6, 23, 0.6);
      transition: transform .22s ease;
    }

    .card:hover {
      transform: translateY(-4px)
    }

    h2.section-title {
      margin: 0 0 8px;
      font-size: 15px;
      color: #dff7ff;
      display: flex;
      align-items: center;
      gap: 8px
    }

    p.lead {
      margin: 6px 0 12px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.4
    }

    /* ===== grid inputs (mobile-first) ===== */
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px
    }

    select,
    input[type="text"],input{
      width: 100%;
      appearance: none;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 10px 12px;
      border-radius: 10px;
      color: #eaf7ff;
      font-size: 14px;
      outline: none;
    }

    select:focus,
    input:focus {
      box-shadow: 0 8px 24px rgba(123, 44, 255, 0.06);
      border-color: rgba(123, 44, 255, 0.12)
    }

    input::placeholder {
      color: rgba(230, 240, 250, 0.3)
    }

    /* make single-column on tiny screens */
    @media (max-width:420px) {
      .grid {
        grid-template-columns: repeat(1, 1fr)
      }
    }

    /* ===== prompt area (scroll-x) ===== */
    .prompt-row {
      display: flex;
      gap: 8px;
      align-items: flex-start
    }

    .prompt-scroll {
      flex: 1;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.01));
      padding: 10px;
      border-radius: 10px;
      overflow-x: auto;
      white-space: nowrap;
      border: 1px solid rgba(255, 255, 255, 0.03);
      color: #cfeffc;
      font-size: 13px;
    }

    .prompt-scroll pre {
      margin: 0;
      display: inline-block;
      white-space: pre;
      color: #cfeffc
    }

    .prompt-actions {
      display: flex;
      flex-direction: column;
      gap: 8px
    }

    /* buttons */
    .btn {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #031824;
      font-weight: 700;
      padding: 10px 12px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0, 210, 255, 0.08)
    }

    .btn:hover {
      transform: translateY(-3px)
    }

    .ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.05);
      color: var(--muted);
      padding: 10px;
      border-radius: 10px;
      cursor: pointer
    }

    /* json area */
    textarea.json-input {
      width: 100%;
      min-height: 140px;
      background: linear-gradient(180deg, rgba(2, 6, 12, 0.5), rgba(6, 12, 20, 0.45));
      border: 1px solid rgba(255, 255, 255, 0.04);
      color: #d6eefc;
      padding: 12px;
      border-radius: 12px;
      font-size: 14px;
      resize: vertical;
      outline: none
    }

    .muted-note {
      color: var(--muted);
      font-size: 13px;
      margin-top: 8px
    }

    /* ===== quiz area ===== */
    .quiz-card {
      padding: 16px;
      margin-top: 6px;
      border-radius: 12px
    }

    .q-top {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: flex-start;
      margin-bottom: 12px
    }

    .q-title {
      font-weight: 700;
      font-size: 16px;
      color: #e9fbff;
      margin: 0
    }

    .q-sub {
      color: var(--muted);
      font-size: 12px
    }

    .progress-wrap {
      width: 100%;
      height: 10px;
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.03)
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      transition: width .45s cubic-bezier(.2, .9, .3, 1);
      box-shadow: 0 6px 18px rgba(123, 44, 255, 0.08)
    }

    .options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 12px
    }

    .opt-btn {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.015), rgba(255, 255, 255, 0.01));
      color: #e6f6ff;
      border: 1px solid rgba(255, 255, 255, 0.03);
      padding: 12px;
      border-radius: 10px;
      text-align: left;
      cursor: pointer;
      transition: transform .12s, box-shadow .12s
    }

    .opt-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(2, 10, 30, 0.6);
      border-color: rgba(0, 210, 255, 0.12)
    }

    .opt-btn.disabled {
      opacity: 0.85;
      cursor: default;
      transform: none
    }

    .opt-btn.correct {
      border-color: rgba(38, 194, 129, 0.9);
      background: linear-gradient(180deg, rgba(38, 194, 129, 0.06), rgba(38, 194, 129, 0.02));
      color: #dff7ee
    }

    .opt-btn.wrong {
      border-color: rgba(255, 107, 107, 0.9);
      background: linear-gradient(180deg, rgba(255, 107, 107, 0.06), rgba(255, 107, 107, 0.02));
      color: #ffdfe0
    }

    .explain {
      margin-top: 12px;
      padding: 12px;
      border-radius: 10px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.01));
      border-left: 4px solid rgba(0, 210, 255, 0.16);
      color: #cfeefc;
      display: none
    }

    .timer-wrap {
      display: flex;
      align-items: center;
      gap: 12px
    }

    .timer-ring {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      background: conic-gradient(var(--accent) 0deg, rgba(255, 255, 255, 0.03) 0deg);
      box-shadow: 0 6px 26px rgba(0, 0, 0, 0.5)
    }

    .timer-number {
      font-size: 15px;
      font-weight: 700;
      color: #eaf7ff
    }

    .next-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 12px
    }

    .next-btn {
      background: linear-gradient(90deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.02));
      color: #cfeffc;
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 10px 12px;
      border-radius: 10px;
      cursor: pointer
    }

    .next-btn:hover {
      transform: translateY(-3px)
    }

    /* result screen */
    .result-card {
      text-align: center;
      padding: 16px;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border: 1px solid rgba(255, 255, 255, 0.03);
      box-shadow: 0 18px 40px rgba(3, 6, 16, 0.6)
    }

    .stat {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 12px 0;
      flex-wrap: wrap
    }

    .pill {
     background: linear-gradient(90deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      border: 1px solid rgba(255, 255, 255, 0.03);
      padding: 10px 12px;
      border-radius: 10px;
      min-width: 110px;
      color: #eaf7ff
    }

    .big-num {
      font-size: 24px;
      font-weight: 800;
      color: var(--accent)
    }

    /* ===== mobile menu (side drawer) ===== */
    .drawer-backdrop {
      position: fixed;
      inset: 0;
     background: rgba(0, 0, 0, 0.45);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s;
      z-index: 80
    }

    .drawer {
      position: fixed;
      left: -320px;
      top: 0;
      height: 100%;
      width: 280px;
      background: linear-gradient(180deg, #071528, #041023);
      box-shadow: 10px 0 40px rgba(1, 4, 12, 0.7);
      padding: 18px;
      border-right: 1px solid rgba(255, 255, 255, 0.03);
      z-index: 90;
      transition: left .22s cubic-bezier(.2, .9, .3, 1)
    }

    .drawer.open {
      left: 0
    }

    .drawer-backdrop.open {
      opacity: 1;
      pointer-events: auto
    }

    .drawer .menu h3 {
      margin: 0 0 12px;
      font-size: 15px;
      color: #dff7ff
    }

    .drawer .menu button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 8px;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.02);
      color: #cfeffc;
      cursor: pointer
    }

    .drawer .menu button:hover {
      background: rgba(255, 255, 255, 0.02);
      transform: translateY(-2px)
    }

    /* responsive tweaks for larger screens */
    @media (min-width:860px) {
      .page {
        padding: 0 26px
      }

      .grid {
        grid-template-columns: repeat(4, 1fr)
      }

      .prompt-actions {
        flex-direction: row
      }

      .prompt-row {
        align-items: center
      }

      .hambutton {
        display: none
      }

      .nav-actions {
        display: flex
      }

      .drawer {
        display: none
      }
    }

    @media (min-width:720px) and (max-width:859px) {
      .grid {
        grid-template-columns: repeat(3, 1fr)
      }

      .prompt-actions {
        flex-direction: row
      }
    }
    .prompt-row{
      display:none;
    }
  </style>
</head>

<body>
  <div class="launch-banner">üöÄ Grand Launch ‚Äî AI-Powered Quiz | By Developer Fidaur üë®‚Äçüíª</div>

  <!-- topbar -->
  <div class="topbar" role="banner" aria-label="Top navigation">
    <div class="brand" aria-hidden="false">
      <div class="logo">L</div>
      <div>
        <h1>Luminzo ‚Äî GPT Mode</h1>
        <p>Free GPT-powered quiz generator</p>
      </div>
    </div>

    <div style="display:flex;align-items:center;gap:8px">
  

      <div class="hamburger" aria-hidden="false">
        <div class="hambutton" id="hambutton" aria-label="Open menu" title="Menu" role="button">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 6h18v2H3zM3 11h18v2H3zM3 16h18v2H3z" />
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- side drawer -->
  <div class="drawer-backdrop" id="drawerBackdrop" onclick="closeDrawer()"></div>
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="menu">
      <h3>Quick Links</h3>
      <button onclick="goHome()">üè† Home</button>
      <button onclick="openLeaderboard()">üèÜ Leaderboard</button>
      <button onclick="openSettings()">‚öôÔ∏è Settings</button>
      <button id="logoutBtn" onclick="logout()">üö™ Logout</button>
      <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0">
      <h3>About</h3>
      <p style="color:var(--muted);font-size:13px;margin:0 0 10px">Use this mode to generate quizzes for free by copying a prompt to ChatGPT and pasting the JSON here.</p>
    </div>
  </aside>

  <main class="page" role="main">
    <!-- PROMPT GENERATOR CARD -->
    <section class="card" id="promptCard" aria-labelledby="prompt-title">
      <h2 id="prompt-title" class="section-title">üéØ Generate Custom Prompt</h2>
      <p class="lead">Choose class, subject and chapter ‚Äî copy the prompt and paste it into ChatGPT. Then paste ChatGPT's JSON response below.</p>

      <div class="grid" role="form" aria-label="Prompt options">
        <select id="classSelect" aria-label="Class">
          <option value="">Class</option>
          <option>6</option>
          <option>7</option>
          <option>8</option>
          <option>9</option>
          <option>10</option>
          <option>11</option>
          <option>12</option>
        </select>

        <select id="subjectSelect" aria-label="Subject">
          <option value="">Subject</option>
          <option>Science</option>
          <option>Mathematics</option>
          <option>English</option>
          <option>Social Science</option>
          <option>Computer</option>
          <option>Hindi</option>
        </select>

        <input id="chapterInput" type="text" placeholder="Chapter name" aria-label="Chapter" />
              <label for="topic">Enter Topic:</label>
      <input id="topic"> 
<label for="age">Quantity:</label>
<input type="range" id="quantity" name="quantity" min="10" max="50" value="30" oninput="this.nextElementSibling.value = this.value">
<output for="age">30</output>

        <select id="languageSelect" aria-label="Language">
          <option value="English">English</option>
          <option value="Hindi">Hindi</option>
        </select>
      </div>

      <div style="height:10px"></div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" onclick="generatePrompt()">Generate Prompt</button>
        <button class="ghost" onclick="resetPrompt()">Reset</button>
        <div style="flex:1"></div>
      </div>

      <div style="height:10px"></div>
      <div class="prompt-row" style="align-items:flex-start">
        <div class="prompt-scroll" id="promptScroll" title="Generated prompt (scroll horizontally)">
          <pre id="generatedPrompt">Generate 10 multiple-choice questions... (press Generate)</pre>
        </div>
        <div class="prompt-actions" role="group" aria-label="Prompt actions">
          <button class="btn" onclick="copyGeneratedPrompt()">Copy</button>
          <button class="ghost" onclick="window.open('https://chat.openai.com','_blank')">Open ChatGPT</button>
        </div>
      </div>
    </section>

    <!-- JSON Paste Card -->
    <section class="card" id="jsonCard" aria-labelledby="json-title">
      <h2 id="json-title" class="section-title">üì• Paste ChatGPT JSON Output</h2>
      <p class="lead">After pasting the JSON array (exact format), tap <strong>Generate Quiz</strong>.</p>

      <textarea id="jsonInput" class="json-input" placeholder='Paste ChatGPT JSON here (pure array)...' aria-label="Paste JSON"></textarea>

      <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
        <button class="btn" onclick="loadQuiz()">Generate Quiz</button>
        <button class="ghost" onclick="clearJSON()">Clear</button>
        <div style="flex:1"></div>
        <div class="muted-note">No API key needed ‚Äî free method using ChatGPT</div>
      </div>
    </section>

    <!-- QUIZ AREA -->
    <section id="quizWrapper" style="display:none">
      <div class="card quiz-card" id="quizCard" role="region" aria-live="polite">
        
            
        <div class="q-top">
          <div style="flex:1">
            <div class="q-title" id="qTitle">Q1. Title</div>
            <div class="q-sub" id="qSub">Class ‚Ä¢  Subject ‚Ä¢ Chapter</div>
          </div>

          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:10px;min-width:160px">
            <div style="width:100%;max-width:220px">
          <div class="progress-wrap" aria-hidden="true">
                <div class="progress-fill" id="progressFill" style="width:0%"></div>
              </div>
            </div>

            <div class="timer-wrap">
              <div class="timer-ring" id="timerRing" aria-hidden="true">
                <div class="timer-number" id="timerNumber">30</div>
              </div>
              <div style="text-align:right;font-size:12px;color:var(--muted)">
                <div>Time left</div>
                <div id="smallTimer">30s</div>
              </div>
            </div>
          </div> 
        </div>

        <div id="optionsArea" class="options" aria-label="Answer options"></div>

        <div class="explain" id="explainBox" aria-live="polite"></div>

        <div class="next-row"><button class="next-btn" id="nextBtn" style="display:none" onclick="goNext()">Next Question ‚ñ∂</button></div>
      </div>
    </section>

    <!-- RESULT -->
    <section id="resultWrapper" style="display:none">
      <div class="card result-card" id="resultCard" role="status">
        <h2 style="margin:0 0 6px">üéâ Quiz Completed</h2>
        <p class="muted-note">Well done ‚Äî here's how you performed</p>

        <div class="stat" id="statRow">
          <div class="pill">
            <div style="font-size:12px;color:var(--muted)">Score</div>
            <div class="big-num" id="resScore">0 / 0</div>
          </div>
          <div class="pill">
            <div style="font-size:12px;color:var(--muted)">Total Time</div>
            <div class="big-num" id="resTime">0s</div>
          </div>
          <div class="pill">
            <div style="font-size:12px;color:var(--muted)">Accuracy</div>
            <div class="big-num" id="resPercent">0%</div>
          </div>
        </div>

        <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
          <button class="btn" onclick="restart()">Try Again</button>
          <button class="ghost" onclick="downloadResults()">Export</button>
        </div>
      </div>
    </section>

  </main>

  <script>
    // ========= state =========
    let quizData = [];
    let currentIndex = 0;
    let score = 0;
    const perQuestionSeconds = 30;
    let timerInterval = null;
    let remaining = perQuestionSeconds;
    let totalTime = 0;
    let userMeta = { cls: '', subject: '', chapter: '', lang: 'English' };

    // ========= drawer logic =========
    const drawer = document.getElementById('drawer');
    const backdrop = document.getElementById('drawerBackdrop');
    const hambutton = document.getElementById('hambutton');
    hambutton.addEventListener('click', toggleDrawer);

    function toggleDrawer() {
      const open = drawer.classList.toggle('open');
      backdrop.classList.toggle('open', open);
      drawer.setAttribute('aria-hidden', !open);
    }

    function closeDrawer() {
      drawer.classList.remove('open');
      backdrop.classList.remove('open');
      drawer.setAttribute('aria-hidden', 'true');
    }
    // close on Escape
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeDrawer(); });

    // ======== small navigation placeholders ========
    function goHome() { window.location.href = 'home.html'; }

    function openLeaderboard() { alert('Leaderboard ‚Äî implement later'); }

    function openSettings() { alert('Settings ‚Äî implement later'); }

    function logout() { if (confirm('Log out?')) { localStorage.removeItem('username');
        window.location.href = 'user.html'; } }

    // ========= prompt generation =========
    function resetPrompt() {
      document.querySelector('.prompt-row').style.display='none';
      document.getElementById('classSelect').value = '';
      document.getElementById('subjectSelect').value = '';
      document.getElementById('chapterInput').value = '';
      document.getElementById('languageSelect').value = 'English';
      document.getElementById('generatedPrompt').textContent = 'Generate 10 multiple-choice questions... (press Generate)';
    }

    function generatePrompt() {
      const cls = document.getElementById('classSelect').value.trim();
      const subject = document.getElementById('subjectSelect').value.trim();
      const topic= document.getElementById('topic').value.trim();
      const quantity = document.getElementById('quantity').value.trim();
      const chapter = document.getElementById('chapterInput').value.trim();
      const lang = document.getElementById('languageSelect').value || 'English';
      if (!cls || !subject || !chapter) { alert('Please select class, subject and enter chapter name.'); return; }
      
      userMeta = { cls, subject, chapter, lang };
      var prompt='1234';
      if(subject=='English'){
        prompt=`Generate ${quantity} multiple-choice questions for Class ${cls} ${subject}, Chapter - ${chapter},topic-${topic}in ${lang} language. Return ONLY the output in pure JSON array format exactly like the example below (no extra text, no explanation, no markdown):

[ { "question": "The mirror used by dentists to see enlarged images of teeth is:", "options": ["Concave mirror", "Convex mirror", "Plane mirror", "Parabolic mirror"], "correct_answer": "Concave mirror", "explanation": "Concave mirrors give magnified images when the object is close." } ] The question pattern should be according to latest cbse 10th boards exam pattern, include the types of question they ask-competency based,error correction,fill the gap etc. Use Internet to explore boards latest question papers. Overall this quiz should give board exam level vibes. IMPORTANT: Ensure "correct_answer" value exactly matches one of the options. the json should be fully valid and strict- ‚úî No trailing commas ‚úî All quotes valid ‚úî Fully parseable

Do not include any additional commentary`
      }
      else if(subject==="Science"){
        prompt = `Generate ${quantity} multiple-choice questions for Class ${cls} ${subject}, Chapter - ${chapter},topic-${topic}in ${lang} language. Return ONLY the output in pure JSON array format exactly like the example below (no extra text, no explanation, no markdown):

[ { "question": "The mirror used by dentists to see enlarged images of teeth is:", "options": ["Concave mirror", "Convex mirror", "Plane mirror", "Parabolic mirror"], "correct_answer": "Concave mirror", "explanation": "Concave mirrors give magnified images when the object is close." } ] The question pattern should be according to latest cbse class ${cls}  boards exam pattern, include the types of question they ask-Competency-based MCQs
Assertion‚ÄìReason,
Case Study / Source-Based,
Experiment / Activity-based Questions,
Very Short Answer,
Short Answer (Conceptual + Application),
Long Answer,
Numerical Problem Solving,
Fill in the Blank (Conceptual),
Reasoning / Explain Why Type,Differentiate / Compare,
Definition + Example Based.
Use Internet to explore boards latest question papers. Overall this quiz should give board exam level vibes. IMPORTANT: Ensure "correct_answer" value exactly matches one of the options. the json should be fully valid and strict- ‚úî No trailing commas ‚úî All quotes valid ‚úî Fully parseable

Do not include any additional commentary`
      }
      else if(subject==="Social Science"){
        prompt=`Generate ${quantity} multiple-choice questions for Class ${cls} ${subject}, Chapter - ${chapter},topic-${topic}in ${lang} language. Return ONLY the output in pure JSON array format exactly like the example below (no extra text, no explanation, no markdown):

[ { "question": "The mirror used by dentists to see enlarged images of teeth is:", "options": ["Concave mirror", "Convex mirror", "Plane mirror", "Parabolic mirror"], "correct_answer": "Concave mirror", "explanation": "Concave mirrors give magnified images when the object is close." } ] The question pattern should be according to latest cbse class  ${cls} boards exam pattern, include the types of question they ask-Competency-based MCQs,
Case-based Source + Interpretation,
Assertion‚ÄìReason,
Very Short Answer,
Short Answer (History / Civics / Geography),
Long Answer (Explanation + Interpretation),
Map-based Question,
Fill in the Blank / Statement Completion,
Cause-Effect Based Questions,
Timeline / Sequence-based
. Use Internet to explore boards latest question papers. Overall this quiz should give board exam level vibes. IMPORTANT: Ensure "correct_answer" value exactly matches one of the options. the json should be fully valid and strict- ‚úî No trailing commas ‚úî All quotes valid ‚úî Fully parseable

Do not include any additional commentary`
      }
      else if(subject==="Mathematics"){
        prompt=`Generate ${quantity} multiple-choice questions for Class ${cls} ${subject}, Chapter - ${chapter},topic-${topic}in ${lang} language. Return ONLY the output in pure JSON array format exactly like the example below (no extra text, no explanation, no markdown):

[ { "question": "The mirror used by dentists to see enlarged images of teeth is:", "options": ["Concave mirror", "Convex mirror", "Plane mirror", "Parabolic mirror"], "correct_answer": "Concave mirror", "explanation": "Concave mirrors give magnified images when the object is close." } ] The question pattern should be according to latest cbse class ${cls} boards exam pattern, include the types of question they ask-Competency-based Word Problems,
MCQs + Assertion‚ÄìReason,
Case Study / Data-Based,
Very Short Answer (Steps Not Required),
Short Answer (Full Steps Required),
Long Answer (Application + Proof-type),
Diagram / Graph-based Question,
Solve and Find (Value/Roots/Length/Area/etc.),
Fill the Gap (Formula/Result),
Error Correction (Misconception-based).
 Use Internet to explore boards latest question papers. Overall this quiz should give board exam level vibes. IMPORTANT: Ensure "correct_answer" value exactly matches one of the options. the json should be fully valid and strict- ‚úî No trailing commas ‚úî All quotes valid ‚úî Fully parseable

Do not include any additional commentary`
      }
      else if(subject==="Hindi"){
        prompt=`Generate ${quantity} multiple-choice questions for Class ${cls} ${subject}, Chapter - ${chapter},topic-${topic}in ${lang} language. Return ONLY the output in pure JSON array format exactly like the example below (no extra text, no explanation, no markdown):

[ { "question": "The mirror used by dentists to see enlarged images of teeth is:", "options": ["Concave mirror", "Convex mirror", "Plane mirror", "Parabolic mirror"], "correct_answer": "Concave mirror", "explanation": "Concave mirrors give magnified images when the object is close." } ] The question pattern should be according to latest cbse class ${cls} boards exam pattern, include the types of question they ask-‡§Ö‡§™‡§†‡§ø‡§§ ‡§ó‡§¶‡•ç‡§Ø‡§æ‡§Ç‡§∂ (Comprehension),
‡§Ö‡§™‡§†‡§ø‡§§ ‡§ï‡§æ‡§µ‡•ç‡§Ø‡§æ‡§Ç‡§∂ (Poem Comprehension),
‡§µ‡•ç‡§Ø‡§æ‡§ï‡§∞‡§£ (Grammar Based),
Error Detection/Correction (‡§§‡•ç‡§∞‡•Å‡§ü‡§ø-‡§∂‡•ã‡§ß‡§®),
Fill in the Blanks (‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∏‡•ç‡§•‡§æ‡§® ‡§™‡•Ç‡§∞‡•ç‡§§‡§ø),
‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® (Active-Passive, Direct-Indirect, ‡§Ü‡§¶‡§ø),
‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞/‡§∏‡§Æ‡§æ‡§∏/‡§µ‡§ø‡§≤‡•ã‡§Æ/‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø‡§µ‡§æ‡§ö‡•Ä ‡§™‡§π‡§ö‡§æ‡§®,
‡§ï‡§æ‡§µ‡•ç‡§Ø/‡§ó‡§¶‡•ç‡§Ø ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®,
Competency-based MCQs,
Short Answer Interpretative,
Long Answer Literary Explanation,
‡§≤‡•á‡§ñ‡§® ‡§ï‡•å‡§∂‡§≤ (Creative Writing),
‡§î‡§™‡§ö‡§æ‡§∞‡§ø‡§ï/‡§Ö‡§®‡•å‡§™‡§ö‡§æ‡§∞‡§ø‡§ï ‡§™‡§§‡•ç‡§∞,
‡§∏‡•Ç‡§ö‡§®‡§æ/‡§Ö‡§®‡•Å‡§ö‡•ç‡§õ‡•á‡§¶/‡§∏‡§Ç‡§µ‡§æ‡§¶ ‡§≤‡•á‡§ñ‡§®,
‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§™‡§®/‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§≤‡•á‡§ñ‡§®.
 Use Internet to explore boards latest question papers. Overall this quiz should give board exam level vibes. IMPORTANT: Ensure "correct_answer" value exactly matches one of the options. the json should be fully valid and strict- ‚úî No trailing commas ‚úî All quotes valid ‚úî Fully parseable

Do not include any additional commentary`
      }
      else if(subject==="Computer"){
        prompt=`Generate ${quantity} multiple-choice questions for Class ${cls} ${subject}, Chapter - ${chapter},topic-${topic}in ${lang} language. Return ONLY the output in pure JSON array format exactly like the example below (no extra text, no explanation, no markdown):

[ { "question": "The mirror used by dentists to see enlarged images of teeth is:", "options": ["Concave mirror", "Convex mirror", "Plane mirror", "Parabolic mirror"], "correct_answer": "Concave mirror", "explanation": "Concave mirrors give magnified images when the object is close." } ] The question pattern should be according to latest cbse class ${cls} boards exam pattern, include the types of question they ask-Competency-Based MCQs,
Case/Scenario-Based Questions,
Input‚ÄìOutput Interpretation,
Fill in the Blanks,
True/False,
Match the Following,
One-Word Answer,
Identify Tool/Feature/Icon,
Shortcut Key Identification,
Difference Between,
Write Steps/Procedure,
Short Answer (Concept Explanation)
Long Answer (Use-Case/Process-Based),
Spreadsheet Formula Output/Debug,
Cyber Safety Case Questions,
Employability Skills MCQs,
Diagram/Label (Optional).
Use Internet to explore boards latest question papers. Overall this quiz should give board exam level vibes. IMPORTANT: Ensure "correct_answer" value exactly matches one of the options. the json should be fully valid and strict- ‚úî No trailing commas ‚úî All quotes valid ‚úî Fully parseable

Do not include any additional commentary`
      }
      else {
       prompt = `Generate ${quantity} multiple-choice questions for Class ${cls} ${subject}, Chapter - ${chapter},topic-${topic} in ${lang} language. Return ONLY the output in pure JSON array format exactly like the example below (no extra text, no explanation, no markdown):

[
  {
    "question": "The mirror used by dentists to see enlarged images of teeth is:",
    "options": ["Concave mirror", "Convex mirror", "Plane mirror", "Parabolic mirror"],
    "correct_answer": "Concave mirror",
    "explanation": "Concave mirrors give magnified images when the object is close."
  }
]

IMPORTANT: Ensure "correct_answer" value exactly matches one of the options. 
the json should be fully valid and strict-
‚úî No trailing commas
‚úî All quotes valid
‚úî Fully parseable

Do not include any additional commentary.

`
}
      document.getElementById('generatedPrompt').textContent = prompt;
      // ensure scroll to start for mobile
      document.getElementById('promptScroll').scrollLeft = 0;
      // close drawer if open (good UX)
      closeDrawer();
      document.querySelector('.prompt-row').style.display='block';
    }

    function copyGeneratedPrompt() {
      const txt = document.getElementById('generatedPrompt').innerText;
      navigator.clipboard.writeText(txt).then(() => { quickToast('Prompt copied'); }).catch(() => { alert('Copy failed ‚Äî select and copy manually'); });
    }

    // ========= JSON paste & validation =========
    function clearJSON() { document.getElementById('jsonInput').value = ''; }

    function loadQuiz() {
      const raw = document.getElementById('jsonInput').value.trim();
      if (!raw) { alert('Paste JSON output from ChatGPT before generating the quiz.'); return; }
      try {
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed) || parsed.length === 0) throw new Error('Expected non-empty array');
        for (const item of parsed) {
          if (typeof item.question !== 'string' || !Array.isArray(item.options) || typeof item.correct_answer !== 'string') {
            throw new Error('Each item must contain question (string), options (array) and correct_answer (string)');
          }
        }
        quizData = parsed;
        startQuiz();
      } catch (e) {
        alert('Invalid JSON ‚Äî make sure you pasted the pure JSON array returned by ChatGPT.\n\nError: ' + e.message);
      }
    }

    // ========= start quiz - hide other sections =========
    function startQuiz() {
      document.getElementById('promptCard').style.display = 'none';
      document.getElementById('jsonCard').style.display = 'none';
      document.getElementById('resultWrapper').style.display = 'none';
      document.getElementById('quizWrapper').style.display = 'block';
      currentIndex = 0;
      score = 0;
      totalTime = 0;
      remaining = perQuestionSeconds;
      renderQuestion();
      // ensure scroll top (mobile)
      window.scrollTo({ top: 0, behavior: 'smooth' });
      closeDrawer();
    }

    // ========= render question & UI =========
    function renderQuestion() {
      clearInterval(timerInterval);
      remaining = perQuestionSeconds;
      updateTimerUI(perQuestionSeconds, perQuestionSeconds);
      if (currentIndex >= quizData.length) { finishQuiz(); return; }
      const q = quizData[currentIndex];
      document.getElementById('qTitle').textContent = `Q${currentIndex+1}. ${q.question}`;
      document.getElementById('qSub').textContent = `${userMeta.cls || 'Class'} ‚Ä¢ ${userMeta.subject || 'Subject'} ‚Ä¢ ${userMeta.chapter || 'Chapter'}`;
      const optionsArea = document.getElementById('optionsArea');
      optionsArea.innerHTML = '';
      q.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'opt-btn';
        btn.textContent = opt;
        btn.onclick = () => selectOption(btn, q);
        optionsArea.appendChild(btn);
      });
      document.getElementById('explainBox').style.display = 'none';
      document.getElementById('explainBox').textContent = '';
      document.getElementById('nextBtn').style.display = 'none';
      updateProgress();
      startTimer();
      // accessibility: focus first option after render
      setTimeout(() => { const first = document.querySelector('.opt-btn'); if (first) first.focus(); }, 220);
    }

    function updateProgress() {
      const percent = ((currentIndex) / Math.max(1, quizData.length)) * 100;
      document.getElementById('progressFill').style.width = percent + '%';
    }

    // ========= timer =========
    function startTimer() {
      clearInterval(timerInterval);
      let elapsed = 0;
      timerInterval = setInterval(() => {
        elapsed++;
        remaining = perQuestionSeconds - elapsed;
        totalTime++;
        if (remaining < 0) remaining = 0;
        updateTimerUI(remaining, perQuestionSeconds);
        if (elapsed >= perQuestionSeconds) {
          clearInterval(timerInterval);
          timeUp();
        }
      }, 1000);
    }

    function updateTimerUI(rem, total) {
      document.getElementById('timerNumber').textContent = rem;
      document.getElementById('smallTimer').textContent = rem + 's';
      const percent = Math.max(0, rem / total);
      const deg = Math.floor(360 * percent);
      document.getElementById('timerRing').style.background = `conic-gradient(var(--accent) 0deg, var(--accent) ${deg}deg, rgba(255,255,255,0.02) ${deg}deg 360deg)`;
    }

    function timeUp() {
      const all = document.querySelectorAll('.opt-btn');
      all.forEach(b => { b.classList.add('disabled');
        b.disabled = true; });
      const explain = document.getElementById('explainBox');
      explain.style.display = 'block';
      explain.textContent = '‚è≥ Time up! The correct answer is highlighted.';
      highlightCorrect();
      document.getElementById('nextBtn').style.display = 'inline-block';
    }

    // ========= selection & result =========
    function selectOption(btn, q) {
      clearInterval(timerInterval);
      const all = document.querySelectorAll('.opt-btn');
      all.forEach(b => { b.classList.add('disabled');
        b.disabled = true; });
      const chosen = btn.textContent;
      const correct = q.correct_answer;
      all.forEach(b => { if (b.textContent === correct) b.classList.add('correct'); });
      if (chosen === correct) { btn.classList.add('correct');
        score++;
        showExplanation(q.explanation || 'Correct'); }
      else { btn.classList.add('wrong');
        showExplanation(q.explanation || ('Correct answer: ' + correct)); }
      document.getElementById('nextBtn').style.display = 'inline-block';
    }

    function highlightCorrect() {
      const q = quizData[currentIndex];
      const all = document.querySelectorAll('.opt-btn');
      all.forEach(b => { if (b.textContent === q.correct_answer) b.classList.add('correct'); });
    }

    function showExplanation(txt) { const ex = document.getElementById('explainBox');
      ex.style.display = 'block';
      ex.textContent = (txt || '').trim(); }

    function goNext() { currentIndex++;
      renderQuestion(); }

    // ========= finish =========
    function finishQuiz() {
      clearInterval(timerInterval);
      document.getElementById('quizWrapper').style.display = 'none';
      document.getElementById('resultWrapper').style.display = 'block';
      document.getElementById('resScore').textContent = `${score} / ${quizData.length}`;
      document.getElementById('resTime').textContent = `${totalTime}s`;
      const pct = Math.round((score / Math.max(1, quizData.length)) * 100);
      document.getElementById('resPercent').textContent = `${pct}%`;
      document.getElementById('progressFill').style.width = '100%';
      // small animate result card
      const rc = document.getElementById('resultCard');
      rc.animate([{ transform: 'scale(.98)' }, { transform: 'scale(1)' }], { duration: 420, easing: 'ease-out' });
      // scroll to results (mobile-friendly)
      setTimeout(() => window.scrollTo({ top: document.getElementById('resultWrapper').offsetTop - 12, behavior: 'smooth' }), 100);
    }

    function restart() {
      document.getElementById('promptCard').style.display = 'block';
      document.getElementById('jsonCard').style.display = 'block';
      document.getElementById('resultWrapper').style.display = 'none';
      document.getElementById('jsonInput').value = '';
      quizData = [];
      currentIndex = 0;
      score = 0;
      totalTime = 0;
      document.getElementById('progressFill').style.width = '0%';
      document.getElementById('generatedPrompt').textContent = 'Generate 10 multiple-choice questions... (press Generate)';
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function downloadResults() {
      const data = { score, totalTime, totalQuestions: quizData.length, date: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'quiz-result.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    // tiny toast
   function quickToast(msg) {
      const el = document.createElement('div');
      el.style.position = 'fixed';
      el.style.right = '14px';
      el.style.bottom = '14px';
      el.style.background = 'linear-gradient(90deg,#08242f,#041323)';
      el.style.color = '#cff6ff';
      el.style.padding = '8px 12px';
      el.style.borderRadius = '10px';
      el.style.boxShadow = '0 8px 30px rgba(0,0,0,0.6)';
      el.style.zIndex = '9999';
      el.textContent = msg;
      document.body.appendChild(el);
      setTimeout(() => el.style.opacity = '0', 1500);
      setTimeout(() => el.remove(), 2100);
    }

    // init
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('generatedPrompt').textContent = 'Generate 10 multiple-choice questions... (press Generate)';
    });

    // accessibility: close drawer when clicking link etc.
    document.querySelectorAll('.drawer .menu button').forEach(b => b.addEventListener('click', closeDrawer));
  </script>
</body>

</html>
